{
  "filename": "Module 2 - Application and Network Attacks - Part 4.pptx",
  "text": "CEN 3078 Computer Security\nModule 2 – Application and Network Attacks\n\n\n2\nModule 2\nTCP fundamental\nAttacks on the TCP protocol\nDenial-of-Service attack\nSQL injection attack\nCross-side scripting attack\nMiscellaneous: Heartbleed bug and attack, Ransomware, Cryptojacking \nInteracting with Database in Web Application\nA typical web application consists of three major components:\n\n\n\n\n\n\n\n\n\n\nSQL (Structured Query Language) Injection attacks can cause damage to the database\nAs we notice in the figure, the users do not directly interact with the database but through a web server; If this channel is not implemented properly, malicious users can attack the database\n\n3\nGetting Data from User\nThis example shows a form where users can type their data; Once the submit button is clicked, an HTTP request will be sent out with the data attached\n\n\n\nThe HTML source of the above form is given below: \n\n\n\n\nRequest generated is:\n\n\n\n\n\n\n\n\n4\nGetting Data from User\nThe request shown is an HTTP GET request, because the method field in the HTML code specified the get type\nIn GET requests, parameters are attached after the question mark in the URL\nEach parameter has a name=value pair and are separated by “&”\nIn the case of HTTPS, the format would be similar but the data will be encrypted\nOnce this request reached the target PHP script the parameters inside the HTTP request will be saved to an array $_GET or $_POST; The following example shows a PHP script getting data from a GET request:\n\n\n\n\n\n\n\n\n\n\n\n5\nHow Web Applications Interact with Database\nConnecting to MySQL Database\nPHP program connects to the database server before conducting query on database \nCode shown below uses new mysqli(…) along with its 4 arguments to create the database connection\n\n\n\n\n\n\n\n\n\n\n6\nMySQLi extension allows PHP programs to access the functionality provided by MySQL 4.1 and above\nHow Web Applications Interact with a Database?\nConstruct the query string and then send it to the database for execution\nData typed in form, eventually become part of the SQL string executed by database\nThe channel between user and database creates a new attack surface for the database – this channel needs protection\n\n\n\n\n\n\n\n\n\n\n7\nLaunching SQL Injection Attacks\nEverything provided by user will become part of the SQL statement (user data is mixed with web application code and given to the database); Is it possible for a user to change the meaning of the SQL statement?\nThe intention of the web app developer by the following is for the user to provide some data for the blank areas:\n\n\n\n\nAssume that a user inputs a random string in the password entry and types “EID5002’#” in the eid entry; The SQL statement will become the following: \n8\nUser is taking help of some special characters (e.g., # which will comment remainder of query i.e., the password check) to change the meaning of the SQL statement\nLaunching SQL Injection Attacks\nEverything from the # sign to the end of line is considered as comment; The SQL statement will be equivalent to the following:\n\n\n\nThe above statement will return the name, salary and SSN of the employee whose EID is EID5002 even though the user doesn’t know the employee’s password; This is a security breach\nLet’s see if a user can get all the records from the database assuming that we don’t know all the EID’s in the database\nWe need to create a predicate for WHERE clause so that it is true for all records (i.e., ‘a’ is dummy that would not have any match, BUT we can add a true condition like “OR 1 =1” to match all the records)\n9\nLaunching SQL Injection Attacks using cURL\n\nMore convenient to use a command-line tool to launch attacks\nEasier to automate attacks without a graphic user interface\nUsing cURL, we can send out a form from a command-line, instead of from a web page as follows:\n\n\nThe above command will not work; In an HTTP request, special characters are in the attached data needs to be encoded (with %20) or they maybe mis-interpreted\nIn the above URL we need to encode the apostrophe, whitespace and the # sign and the resulting cURL command is as shown below:\n\n10\nModify Database\n\n\nConsider the form created for changing passwords; It asks users to fill in three pieces of information, EID, old password and new password\n\nWhen Submit button is clicked, an HTTP POST request will be sent to the server-side script changepasswd.php, which uses an UPDATE statement to change the user’s password\n\n11\nIf the statement is UPDATE or INSERT INTO, we will have chance to change the database\nModify Database\n\nLet us assume that Alice (EID5000) is not satisfied with the salary she gets; She would like to increase her own salary using the SQL injection vulnerability; She would type her own EID and old password. The following will be typed into the “New Password” box:\n\n\nBy typing the above string in “New Password” box, we get the UPDATE statement to SET one more attribute for us, the salary attribute; The SQL statement will now look as follows:\n\n\n\nWhat if Alice doesn’t like Bob and would like to reduce Bob’s salary to 0, but she only knows Bob’s EID (eid5001), not his password; How can she execute the attack?\n12\nDue to SQL injection vulnerability, attackers can change other attributes (e.g., salary)\nMultiple SQL Statements\n\nDamages that can be caused are bounded because we cannot change everything in the existing SQL statement\nIt will be more dangerous if we can cause the database to execute an arbitrary SQL statement\nTo append a new SQL statement “DROP DATABASE dbtest” to the existing SQL statement to delete the entire dbtest database, we can type the following in the EID box\n\nThe resulting SQL statement is equivalent to the following, where we have successfully appended a new SQL statement to the existing SQL statement string\n\n\nThe above attack doesn’t work against MySQL, because in PHP’s mysqli extension, the mysqli::query() API doesn’t allow multiple queries to run in the database server\n \n\n\n\n\n13\nMultiple SQL Statements\nThe code below tries to execute two SQL statements using the $mysqli->query() API\n\n\n\n\n\n\nWhen we run the code, we get the following error message:\n\n\n\n\nIf we do want to run multiple SQL statements, we can use $mysqli -> multi_query() [not recommended for security purposes]\n\n\n14\nSQL Injection Humor\n15\nThe Fundamental Cause\nMixing data and code together is the cause of several types of vulnerabilities and attacks including SQL Injection attack, XSS attack, attacks on the system() function and format string attacks\n\n16\nCross-Site Scripting\nSQL Injection\nShell Script Injection\nCountermeasures: Filtering and Encoding Data\nBefore mixing user-provided data with code, inspect the data; Filter out any character that may be interpreted as code\nSpecial characters are commonly used in SQL Injection attacks; To get rid of them, encode them\nEncoding a special character tells parser to treat the encoded character as data and not as code; This can be seen in the following example\n\n\nPHP’s mysqli extension has a built-in method called mysqli::real_escape_string(); It can be used to encode the characters that have special meanings in SQL\nThe following code snippet shows how to use this API \n\n\n17\nThe filtering or escaping approach doesn’t address the fundamental cause of the problem; Data and code are still mixed together\nCountermeasures: Prepared Statement\nFundament cause of SQL injection: mixing data and code\nFundament solution: separate data and code\nMain Idea: Sending code and data in separate channels to the database server; This way the database server knows not to retrieve any code from the data channel\nHow: using prepared statement\nPrepared Statement: \nIt is an optimized feature that provides improved performance if the same or similar SQL statement needs to be executed repeatedly\nUsing prepared statements, we send an SQL statement template to the database, with certain values called parameters left unspecified\nThe database parses, compiles and performs query optimization on the SQL statement template and stores the result without executing it; We later bind data to the prepared statement\n\n18\nCountermeasures: Prepared Statement\nThe vulnerable version: code and data are mixed together\n\n\nUsing prepared statements, we separate code and data \nSend code\nSend data\nStart execution\n19\nWhy Are Prepared Statements Secure?\nTrusted code is sent via a code channel\nUntrusted user-provided data is sent via data channel\nDatabase clearly knows the boundary between code and data\nData received from the data channel is not parsed\nAttacker can hide code in data, but the code will never be treated as code, so it will never be attacked\n\n20\n"
}