{
  "filename": "Lab 2-SEED-Lab2-TCP-Attacks.pdf",
  "text": "SEED Lab 2: TCP attacks \nWalkthrough\nSpring 2025 \nChengyi Qu\nSubmission Due: Feb 18th \nBackground\n• The Transmission Control Protocol (TCP) is one of the main protocols \nof the Internet protocol suite   \n• TCP SYN flood is a type of Distributed Denial of Service (DDoS) attack \nthat exploits part of the normal TCP three-way handshake to consume \nresources on the targeted server and render it unresponsive\n• TCP Reset Attack is a spoofed TCP segment, crafted and sent by an \nattacker, tricks two victims into abandoning a TCP connection, interrupting \npossibly vital communications between them\n• Studying these vulnerabilities help students understand the challenges of \nnetwork security and why many network security measures are needed.\nLab objective\nIn this lab, you need to conduct several attacks on the TCP protocol. This \nlab covers the following topics:\n✓ TCP protocol  \n✓ TCP SYN flood attack, and SYN cookies\n✓ TCP reset attacks\n✓ TCP session hijacking attack\n✓ Reverse shell\nLab Environment Setup\n• Network Security Lab:\nhttps://seedsecuritylabs.org/Labs_20.04/Files/TCP_Attacks/TCP_Attacks.pdf\n• Virtual Machine download:\nhttps://seedsecuritylabs.org/labsetup.html\n• Virtual Machine setup manual:\nhttps://github.com/seed-labs/seed-labs/blob/master/manuals/vm/seedvm-manual.md\nSetup the Docker Container\n• Docker container can run whole application or a service.\n• It helps in eliminating the usage of virtual machine images\n• Attacker, Victim, User1, User2\n• Download the “Labsetup.zip” from the manual (Different from lab 1!)\n• Enter the Labsetup folder and use the docker-compose.yml file to set up the lab \nenvironment.\n• Some of the basic docker commands\n• docker-compose up -d (to start the container)\n• dockps (to find out container ID)\n• docksh <id> (to log into the container) \nhttps://seedsecuritylabs.org/Labs_20.04/Networking/TCP_Attacks/ \nTasks\nConduct various attacks on the TCP/IP protocols.\n• Task 1: SYN Flooding Attack (50 points)\n• Task 1.1: Launching the Attack Using Python\n• Task 1.2: Launch the Attack Using C\n• Task 1.3: Enable the SYN Cookie Countermeasure\n• Task 2: TCP RST Attacks on telnet Connections (25 points)\n• Task 3: TCP Session Hijacking (25 points)\n• Task 4: Creating Reverse Shell using TCP Session Hijacking (bonus 20 \npoints!)\nhttps://seedsecuritylabs.org/Labs_20.04/Files/TCP_Attacks/TCP_Attacks.pdf\nTask 1: SYN Flooding Attack\n• SYN flood is a form of DoS attack in which attackers send many SYN requests to a \nvictim’s TCP port, but the attackers have no intention to finish the 3-way handshake \nprocedure. \n• Understand how TCP 3-way handshake works\n Connection queue:\n• Queue setting: $ sudo sysctl -q net.ipv4.tcp_max_syn_backlog\n• Queue usage: $ netstat -nat\n➢Turning off SYN Cookie Countermeasure:\n• $ sudo sysctl -a | grep cookie (Display the SYN cookie flag)\n• $ sudo sysctl -w net.ipv4.tcp_syncookies=0 (turn off SYN cookie)\n• $ sudo sysctl -w net.ipv4.tcp_syncookies=1 (turn on SYN cookie)\n➢Task 1.1 and Task 1.3: Please run your attacks with the SYN cookie \nmechanism on and off and compare the results (on telnet connection). And \ndescribe why the SYN cookie can effectively protect the machine against \nthe SYN flooding attack.\nTask 1: SYN Flooding Attack\n➢Task 1.1: Using Scapy for the same attack. Compare the results between C \nand Python in Task 1.2\n• Remember to use “sudo python3”  to execute the code\n• Replace @@@@ with required information \n• This code sends out spoofed TCP SYN packets, with randomly generated \nsource IP address, source port, and sequence number\n• Note: Address the TCP cache issue\nTask 1: SYN Flooding Attack\n#!/bin/env python3 \nfrom scapy.all import IP, TCP, send\n from ipaddress import IPv4Address \nfrom random import getrandbits\n ip = IP(dst=\"*.*.*.*\")\n tcp = TCP(dport=**, flags=’S’) \npkt = ip/tcp \nwhile True:\n         pkt[IP].src = str(IPv4Address(getrandbits(32))) # source iP \n         pkt[TCP].sport = getrandbits(16) # source port\n         pkt[TCP].seq = getrandbits(32) # sequence number\n         send(pkt, verbose = 0) \nNote: It seems that the victim machine \nremembers past successful \nconnections and uses this memory \nwhen establishing future connections \nwith the “returning” client. This \nbehavior does not exist in Ubuntu \n16.04 and earlier versions.\nTo remove the effect of this mitigation \nmethod, we can run the \"ip tcp metrics \nflush\" command on the server.\nTask 1: SYN Flooding Attack\n➢Task 1.2: Launch the Attack Using C\n• We provide a C program called synflood.c in the lab setup. \n• Please compile the program on the VM and then launch the attack on the target machine.\n• Commands:\n• Compile the code on the host VM\n• gcc -o synflood synflood.c\n•  Launch the attack from the attacker container \n• synflood 10.9.0.5 23 \n• Note: Please compare the results with the one using the Python program and explain the \nreason behind the difference.\n➢Objectives: \n• The TCP RST Attack can terminate an established TCP connection \nbetween two victims\n• If there is an established telnet connection (TCP) between two users \nA and B, attackers can spoof a RST packet from A to B, breaking this \nexisting connection. \n• To succeed in this attack, attackers need to correctly construct the \nTCP RST packet. \nTask 2: TCP RST attacks on telnet connection\n➢ Task 2.2:  Launch the above attack using Scapy script\n• Hint 1: use the sample scripts, replace the @@@@ with information \nfrom sniffed packet using e.g. Wireshark\n• Hint 2: the last packet (TCP) in connection is critical\n➢ Describe your observations\nTask 2: TCP RST attacks on telnet connection\n#!/usr/bin/env python3\nfrom scapy.all import * \nip = IP(src=\"@@@@\", dst=\"@@@@\") tcp = \nTCP(sport=@@@@, dport=@@@@, \nflags=\"@@@@\", seq=@@@@, ack=@@@@)\npkt = ip/tcp\nls(pkt) \nsend(pkt,verbose=0) \n• Hijack an existing TCP connection (session) between two victims by \ninjecting malicious contents into this session\n• In telnet session, attackers can inject malicious commands (e.g. deleting an \nimportant file) into this session\n• Objective: Demonstrate how you can hijack a telnet session between two \ncomputers. Your goal is to get the the telnet server to run a malicious \ncommand from you\nTask 3: TCP Session Hijacking\n➢Task 3 Using Scapy\n• Modify data field with shell command,\ne.g. “\\n touch /tmp/myfile.txt\\n”\n• Hint 1: use the sample scripts, replace the @@@@ with information from \nsniffed packet using e.g. Wireshark\n• Hint 2: the last packet (telnet protocol) in connection is critical\n• Hint 3: Interchange the values\n• src <-> dst\n• sport <-> dport\n• seq <-> ack\n \n \nTask 3: TCP Session Hijacking\n#!/usr/bin/python\nfrom scapy.all import *\nip = IP(src=\"@@@@\", dst=\"@@@@\")\ntcp = TCP(sport=@@@@, dport=@@@@, \nflags=\"@@@@\", seq=@@@@, ack=@@@@)\ndata = \"@@@@\"\npkt = ip/tcp/data\nls(pkt)\nsend(pkt,verbose=0)\n• Attackers are interested in running many commands, running these \ncommands all through TCP session hijacking is inconvenient\n• Attackers want to achieve is to use the attack to set up a back door\n• Reverse shell from the victim machine to give the attack the shell access to \nthe victim machine\n• Hint: Interchange the values\n• src <-> dst\n• sport <-> dport\n• seq <-> ack\nTask 4: Creating Reverse Shell using TCP Session \nHijacking (Bonus task – 20 points)\n➢Task 4: demonstrate that you can achieve the goal as shown in the figures by \nlaunching an TCP session hijacking attack on an existing telnet session between \na user and the target server\n• You can use the program provided to complete this task.\nTask 4: Creating Reverse Shell using TCP Session \nHijacking\nWhat you need to submit\n✓A detailed lab report that should include: \no Code: Copy/Screenshot your code on each tasks\no Output: Screen shots showing you successfully achieve the attacks. \nYou may also include texts on: the design of your attacks, including the \nattacking strategies, the packets that you use in your attacks, the tools \nthat you used, etc..\no Observation and Explanation: Is your attack successful? How do you \nknow whether it has succeeded or not? What do you expect to see? \nWhat have you observed? Is the observation a surprise to you?\nSubmission Due: Feb 18th \nReferences\n• https://seedsecuritylabs.org/labsetup.html\n• https://seedsecuritylabs.org/Labs_20.04/Networking/TCP_Attacks/\n• https://seedsecuritylabs.org/Labs_20.04/Files/TCP_Attacks/TCP_Atta\ncks.pdf\n"
}